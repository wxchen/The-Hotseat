<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name='HandheldFriendly' content='True' />
		<meta name='viewport' content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0' />
		<title>The Hot Seat - 3D</title>
		
		<!-- JQuery -->
		<script type="text/javascript" src="js/jquery.min.js"></script>

		<style>
		
html, body { height: 100%; }

body {
	background-color: white;
	color: black;
	margin: 0px;
	padding: 0px;
	overflow: hidden;
}

.map,.image {
	width: 500px;
	height: 500px;	
}

.image {
	/*background-image: url('img/map.png');*/
}

.box1 .front { background: rgba(255,0,0,0.8); }
.box1 .back { background: rgba(255,0,0,0.8); }
.box1 .left { background: rgba(255,0,0,0.8); }
.box1 .right { background: rgba(255,0,0,0.8); }
.box1 .bottom { background: rgba(255,0,0,0.8); }
.box1 .top { background: rgba(255,0,0,0.8); }
			
		</style>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
</script>

<script type="text/javascript">

	var currentInfoWindow;
	var map;
	var geocoder;
	var markersArray = new Array();
	
	function initialize() 
	{
		// Create map
		var latlng = new google.maps.LatLng(-27.3456, 133.4346);
		var myOptions = {
		  zoom: 4,
		  center: latlng,
		  mapTypeId: google.maps.MapTypeId.TERRAIN
		};
		map = new google.maps.Map(document.getElementById("map_canvas"),
		    myOptions);
		
		// Create geocoder
		geocoder = new google.maps.Geocoder();
	}

	// Put a marker on the map
	function addMarker(map, latitude, longitude, locationDescription, locationAddress, tags, locationId)
	{
		var myLatlng = new google.maps.LatLng(latitude, longitude);
		var myOptions = {
		  zoom: 4,
		  center: myLatlng,
		  mapTypeId: google.maps.MapTypeId.ROADMAP,
		  maxHeight: 500,
		  maxWidth: 350
		}
		
		var contentString = '<div class="marker">' +
				'<div class="markerDetail markerAddress">' + locationAddress + '</div>' +
				'<div class="markerDetail markerTags">' + tags + '</div>' +
				'<div class="markerDetail markerDescription">' + locationDescription + '</div>' +
				'<div class="markerDetail"><a href="./location.php?id=' + locationId + '">More details</a></div>'
			'</div>';
		
		var infowindow = new google.maps.InfoWindow({
		    content: contentString
		});
		
		var marker = new google.maps.Marker({
		    position: myLatlng,
		    map: map,
		    title:"Food location"
		});
		
		// Add to markers array
		markersArray.push(marker);
		
		google.maps.event.addListener(marker, 'click', function() 
		{
		  	// Close current info window
		  	if (currentInfoWindow)
		  	{
				currentInfoWindow.close();
		  	}
		  	
		  	infowindow.open(map,marker);
		  	
		  	// Store as current info window
			currentInfoWindow = infowindow;
		});
		
	}
	
	// Removes all map markers - see
	// http://stackoverflow.com/questions/1544739/google-maps-api-v3-how-to-remove-all-markers
	function removeAllMarkers()
	{
		if (markersArray)
		{
			for (var i = 0; i < markersArray.length; i++ ) 
			{
				markersArray[i].setMap(null);
			}
		}
		
		markersArray = new Array();
	}
	
	
	
	// Search for a location on the map
	function searchLocation()
	{
		var address = document.getElementById("searchLocation").value;
		
		geocoder.geocode( { 'address': address + ', London, UK' }, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) 
			{
				map.setCenter(results[0].geometry.location);
			} 
			else 
			{
				alert("Could not find that location.");
			}
		});
	}
	
	// Search for locations
	function filterLocations()
	{
		// Remove existing markers
		removeAllMarkers();
		
		// Filter url
		var filterUrl = './api/locations/index.php';
		
		// Get date
		var searchDate = $("#searchDate").val();
		
		if (searchDate)
		{
			filterUrl = filterUrl + '?fromDate=' + searchDate;
		}
		
		// Get new list of markers
		$.getJSON(filterUrl, function(data) {
			var items = [];
			
			$.each(data, function() {
				
				addMarker(map, this.latitude, this.longitude, this.description, this.address, 'Furniture', this.id);
			});
		});
	}

</script>

</head>
<body onload="initialize()">
	
	<div id="map_canvas" class="map"></div>
	
		<script src="Sprite3D.js" type="text/javascript"></script>
		<script type="text/javascript">
	
	// Create flat image
	var image = Sprite3D.create(".image")
			.origin(250, 250)
			.rotationX(60)
			.update();
	
	//image.setId('chocolate');
	
	Sprite3D.stage().appendChild( 
		image
	);
	
	// Create a box
	image.appendChild(createBox(440, 350, 14));
	image.appendChild(createBox(370, 400, 14));
	
	// Add the map
	image.appendChild( document.getElementById('map_canvas') );
	
	function createBox(x, y, height)
	{
		var boxSize = 10;
		var box = Sprite3D.box( boxSize, boxSize, height, ".box1" );
		box.rotation( 0, 0, 0);
		box.position( x, y, boxSize / 2 - 2);
		box.update();
		
		return box;
	}


		</script>
	</body>
</html>
